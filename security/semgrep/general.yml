---
rules:
  - id: koa-insecure-samesite
    message: |
      Insecure SameSite setting detected (value "None").
      Cookies with `SameSite: "None"` are sent in third party
      contexts and can open you to CSRF.
      Change to `sameSite: "Lax"` (minimum) or `"Strict"` if
      possible.
    severity: WARNING
    languages:
      - javascript
      - typescript
    metadata:
      category: security
      technology:
        - koa
    pattern-either:
      - pattern: |
          { $$_key: $$_value, ..., sameSite: "None", ... }
      - pattern: |
          { $$_key: $$_value, ..., sameSite: 'None', ... }
      - pattern: |
          ctx.cookies.set($COOKIENAME, $COOKIEVAL, {
            ..., sameSite: "None", ...
          })
      - pattern: |
          ctx.cookies.set($COOKIENAME, $COOKIEVAL, {
            ..., sameSite: 'None', ...
          })
      - pattern: |
          session({
            key: $_key,
            ...,
            sameSite: "None",
            ...
          }, $_app)
      - pattern: |
          session({
            key: $_key,
            ...,
            sameSite: 'None',
            ...
          }, $_app)

  - id: react-dangerously-set-inner-html
    pattern: |
      <div dangerouslySetInnerHTML={{ __html: $HTML }} />
    message: |
      Using dangerouslySetInnerHTML can lead to XSS.
      Avoid or sanitize input.
    severity: WARNING
    languages:
      - javascript
      - typescript
    metadata:
      category: security
      technology:
        - react
        - nextjs
